<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="google-site-verification" content="soS2al0KuMZmiyPzu87KFbqGSn0K9edQ8EkWp_m35n0" />
  

  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Fiddler Extension | Core-Research-Team</title>
<meta name="generator" content="Jekyll v4.0.1" />
<meta property="og:title" content="Fiddler Extension" />
<meta name="author" content="choiys" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="라온화이트햇 핵심연구팀 최용선" />
<meta property="og:description" content="라온화이트햇 핵심연구팀 최용선" />
<link rel="canonical" href="http://202.182.127.225:4000/2020-07-01/Fiddler-Extension" />
<meta property="og:url" content="http://202.182.127.225:4000/2020-07-01/Fiddler-Extension" />
<meta property="og:site_name" content="Core-Research-Team" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-07-01T00:00:00+00:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Fiddler Extension","dateModified":"2020-07-01T00:00:00+00:00","datePublished":"2020-07-01T00:00:00+00:00","author":{"@type":"Person","name":"choiys"},"url":"http://202.182.127.225:4000/2020-07-01/Fiddler-Extension","mainEntityOfPage":{"@type":"WebPage","@id":"http://202.182.127.225:4000/2020-07-01/Fiddler-Extension"},"description":"라온화이트햇 핵심연구팀 최용선","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon.ico">

  <!-- RSS -->
  <link type="application/atom+xml" rel="alternate" href="http://202.182.127.225:4000/feed.xml" title="Core-Research-Team" />

  <!-- Google Analytics-->
  
 
</head>


  <body>

    <nav class="nav">
  <div class="nav-container">
    <a href="/">
      <h2 class="nav-title">RAON - Core Research Team</h2>
    </a>
    <ul>
      <li><a href="/about">About</a></li>
      <li><a href="/">Posts</a></li>
    </ul>
  </div>
</nav>


    <main>
      <div class="post"> 
   <h1 class="post-title">Fiddler Extension</h1>
   <div class="post-line"></div>

   
      
         
            <span class="tag"><center><i>Programming</i></center></span>
         
      
   
   
   <ul>
  <li><a href="#0-개요">0. 개요</a></li>
  <li><a href="#1-fiddler-extension">1. Fiddler Extension</a></li>
  <li><a href="#2-개발-준비">2. 개발 준비</a></li>
  <li><a href="#3-개발-방법">3. 개발 방법</a></li>
  <li><a href="#4-소스코드">4. 소스코드</a></li>
  <li><a href="#5-기능">5. 기능</a></li>
  <li><a href="#5-참조">5. 참조</a></li>
</ul>
   
   <p>라온화이트햇 핵심연구팀 최용선</p>

<h1 id="0-개요">0. 개요</h1>

<p>웹 취약점 분석 및 모의해킹 시 Fiddler에서 패킷을 확인 후 Python 스크립트를 작성하여 자동화하는 과정을 수행하고 있습니다. 본 문서는 이를 위한 기초 템플릿(스니펫)을 만들어주는 Fiddler Extension을 제작하는 과정을 작성하였습니다.</p>

<h1 id="1-fiddler-extension">1. Fiddler Extension</h1>

<p>Fiddler는 Extension이라는 이름으로 플러그인 비슷한 기능을 지원하고 있습니다. 이미 만들어진 Extension을 추가하여 사용할수도 있고, 사용자가 직접 커스텀하여 제작한 Extension을 추가하여 사용하는 것 또한 가능합니다.</p>

<p>Fiddler Extension을 만들기 위해서는 C#을 사용하여 개발 후 .dll 파일로 빌드해야합니다.</p>

<h1 id="2-개발-준비">2. 개발 준비</h1>

<p><img src="/assets/sun0700.png" alt="/assets/sun0700.png" /></p>

<p>Fiddler Extension을 개발하기에 앞서, 설정해주어야하는 부분이 몇 가지 있습니다. 개발에 사용된 IDE는 Visual Studio 2019입니다.</p>

<p>먼저, 위와 같이 <code class="highlighter-rouge">새 프로젝트 만들기</code> 를 선택합니다.</p>

<p><img src="/assets/sun0701.png" alt="/assets/sun0701.png" /></p>

<p>다음으로, dll을 만들기 위해 .NET 프레임워크 프로젝트를 생성합니다.</p>

<p><img src="/assets/sun0702.png" alt="/assets/sun0702.png" /></p>

<p>만들어진 프로젝트의 솔루션 탐색기에서 <code class="highlighter-rouge">참조</code> 를 우클릭하여 <code class="highlighter-rouge">참조 추가</code> 를 선택합니다.</p>

<p><img src="/assets/sun0703.png" alt="/assets/sun0703.png" /></p>

<p><code class="highlighter-rouge">찾아보기</code> 에서 Fiddler Client를 찾아 선택 후 참조에 추가해줍니다.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">C:\Program</span><span class="w"> </span><span class="nx">Files\Fiddler2\Fiddler.exe</span><span class="w">
</span><span class="nf">C:\Program</span><span class="w"> </span><span class="nx">Files</span><span class="p">(</span><span class="nf">x86</span><span class="p">)</span><span class="nf">\Fiddler2\Fiddler.exe</span><span class="w">
</span><span class="nf">C:\Users\</span><span class="p">[</span><span class="kt">UserName</span><span class="p">]</span><span class="nx">\AppData\Local\Programs\Fiddler\Fiddler.exe</span><span class="w">
</span></code></pre></div></div>

<p>일반적인 Fiddler Client의 경로는 위와 같습니다.</p>

<p><img src="/assets/sun0704.png" alt="/assets/sun0704.png" /></p>

<p>추가적으로, 최근 Visual Studio를 사용할 때 <code class="highlighter-rouge">System.Windows.Forms</code> 가 기본으로 등록되어있지 않아 사용 시 에러가 발생할 수 있는데, 위에서 Fiddler Client를 등록한 과정과 유사하게 <code class="highlighter-rouge">참조 관리자</code>에서  <code class="highlighter-rouge">System.Windows.Forms</code> 를 사용하도록 체크해줍니다.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">C:\Users\</span><span class="p">[</span><span class="kt">UserName</span><span class="p">]</span><span class="nx">\Documents\Fiddler2</span><span class="w">
</span></code></pre></div></div>

<p>마지막으로, 빌드하여 만들어진 .dll 파일은 위에서 소개한 Fiddler의 경로 또는 위 경로의 <code class="highlighter-rouge">Scripts</code> 폴더에 넣어준 뒤 Fiddler를 재시작하면 자동으로 Extension이 등록됩니다.</p>

<h1 id="3-개발-방법">3. 개발 방법</h1>

<p>Fiddler Extension 개발은 C#으로 이루어지며, 일반적인 Windows GUI 개발과 비슷하다고 볼 수 있습니다. <code class="highlighter-rouge">2. 개발 준비</code> 에서 등록한 Fiddler 클래스에서 클래스, 메소드 등을 사용하여 Fiddler에서 사용하는 정보를 얻어와 가공하는 것이 가능합니다.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="n">Fiddler</span><span class="p">.</span><span class="nf">RequiredVersion</span><span class="p">(</span><span class="s">"2.2.8.6"</span><span class="p">)]</span>
</code></pre></div></div>

<p>먼저, Fiddler Extension은 Fiddler v2.2.8 이후 적용이 되었기 때문에 위와 같은 코드를 추가해줍니다.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Fiddler</span><span class="p">;</span>

<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="n">Fiddler</span><span class="p">.</span><span class="nf">RequiredVersion</span><span class="p">(</span><span class="s">"2.2.8.6"</span><span class="p">)]</span>

<span class="k">namespace</span> <span class="nn">ClassLibrary2</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span> <span class="p">:</span> <span class="n">IFiddlerExtension</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnLoad</span><span class="p">()</span>
        <span class="p">{</span>

        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnBeforeUnload</span><span class="p">()</span>
        <span class="p">{</span>

        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>그리고 Fiddler Extension 개발을 위해 <code class="highlighter-rouge">IFiddlerExtension</code> 클래스를 상속받습니다.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// IFiddlerExtension 원형</span>

<span class="k">namespace</span> <span class="nn">Fiddler</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">IFiddlerExtension</span>
    <span class="p">{</span>
        <span class="k">void</span> <span class="nf">OnBeforeUnload</span><span class="p">();</span>
        <span class="k">void</span> <span class="nf">OnLoad</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">IFiddlerExtension</code> 는 인터페이스로 선언되어있기 때문에 <code class="highlighter-rouge">OnLoad()</code> 와 <code class="highlighter-rouge">OnBeforeUnload()</code> 를 구현해주어야만 합니다.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>

<span class="k">namespace</span> <span class="nn">ClassLibrary2</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span> <span class="p">:</span> <span class="n">IFiddlerExtension</span>
    <span class="p">{</span>
        <span class="n">TabPage</span> <span class="n">page</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnLoad</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">page</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TabPage</span><span class="p">(</span><span class="s">"TestTab"</span><span class="p">);</span>
            <span class="n">FiddlerApplication</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">tabsViews</span><span class="p">.</span><span class="n">TabPages</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnBeforeUnload</span><span class="p">()</span>
        <span class="p">{</span>

        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ...</span>
</code></pre></div></div>

<p><img src="/assets/sun0705.png" alt="/assets/sun0705.png" /></p>

<p>그리고 <code class="highlighter-rouge">System.Windows.Forms</code> 클래스의 <code class="highlighter-rouge">TabPage</code> 컴포넌트를 사용하여 인스턴스를 생성해주고, <code class="highlighter-rouge">FiddlerApplication.UI.tabsViews.TabPages.Add</code> 메소드를 사용하여 등록해주면 위와 같이 Fiddler에 <code class="highlighter-rouge">TestTab</code> 이라는 이름의 탭이 생성됩니다.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Class1</span> <span class="p">:</span> <span class="n">IFiddlerExtension</span>
    <span class="p">{</span>
        <span class="n">TabPage</span> <span class="n">page</span><span class="p">;</span>
        <span class="n">TextBox</span> <span class="n">textbox</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnLoad</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">page</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TabPage</span><span class="p">(</span><span class="s">"TestTab"</span><span class="p">);</span>
            <span class="n">textbox</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TextBox</span><span class="p">();</span>
            <span class="n">textbox</span><span class="p">.</span><span class="n">Multiline</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="n">textbox</span><span class="p">.</span><span class="n">AcceptsTab</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="n">textbox</span><span class="p">.</span><span class="n">AutoSize</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="n">textbox</span><span class="p">.</span><span class="n">AllowDrop</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="n">textbox</span><span class="p">.</span><span class="n">ReadOnly</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="n">textbox</span><span class="p">.</span><span class="n">ScrollBars</span> <span class="p">=</span> <span class="n">ScrollBars</span><span class="p">.</span><span class="n">Both</span><span class="p">;</span>
            <span class="n">textbox</span><span class="p">.</span><span class="n">Dock</span> <span class="p">=</span> <span class="n">DockStyle</span><span class="p">.</span><span class="n">Fill</span><span class="p">;</span>

            <span class="n">page</span><span class="p">.</span><span class="n">Controls</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">textbox</span><span class="p">);</span>

            <span class="n">FiddlerApplication</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">tabsViews</span><span class="p">.</span><span class="n">TabPages</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnBeforeUnload</span><span class="p">()</span>
        <span class="p">{</span>

        <span class="p">}</span>
    <span class="p">}</span>

<span class="c1">// ...</span>
</code></pre></div></div>

<p><img src="/assets/sun0706.png" alt="/assets/sun0706.png" /></p>

<p>탭 내에 UI를 적절히 구성한 뒤, 앞서 만들어놓은 <code class="highlighter-rouge">page</code> 인스턴스에 있는 <code class="highlighter-rouge">Page.Controls.Add</code> 메소드를 사용하여 구성한 UI 인스턴스를 등록해주면 위와 같이 화면을 구성할 수 있습니다.</p>

<h1 id="4-소스코드">4. 소스코드</h1>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Windows.Forms</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Fiddler</span><span class="p">;</span>

<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="n">Fiddler</span><span class="p">.</span><span class="nf">RequiredVersion</span><span class="p">(</span><span class="s">"2.2.8.6"</span><span class="p">)]</span>

<span class="k">namespace</span> <span class="nn">Test</span>
<span class="p">{</span>
	<span class="k">public</span> <span class="k">class</span> <span class="nc">Test</span> <span class="p">:</span> <span class="n">IFiddlerExtension</span>
	<span class="p">{</span>
		<span class="k">private</span> <span class="n">TabPage</span> <span class="n">page</span><span class="p">;</span>
		<span class="k">private</span> <span class="n">TextBox</span> <span class="n">textbox</span><span class="p">;</span>

		<span class="c1">// QueryString / POST Data 파싱</span>
		<span class="k">private</span> <span class="n">String</span> <span class="nf">parseData</span><span class="p">(</span><span class="n">String</span> <span class="n">method</span><span class="p">,</span> <span class="n">String</span> <span class="n">data</span><span class="p">)</span>
        <span class="p">{</span>
			<span class="kt">int</span> <span class="n">ampIdx</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">IndexOf</span><span class="p">(</span><span class="sc">'&amp;'</span><span class="p">);</span>
			<span class="n">String</span><span class="p">[]</span> <span class="n">queryStrings</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
			<span class="n">String</span> <span class="n">res</span> <span class="p">=</span> <span class="s">"data = {\r\n"</span><span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="n">ampIdx</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
				<span class="n">queryStrings</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="sc">'&amp;'</span><span class="p">);</span>
				<span class="k">foreach</span><span class="p">(</span><span class="n">String</span> <span class="n">queryString</span> <span class="k">in</span> <span class="n">queryStrings</span><span class="p">)</span>
                <span class="p">{</span>
					<span class="kt">int</span> <span class="n">equalsIdx</span> <span class="p">=</span> <span class="n">queryString</span><span class="p">.</span><span class="nf">IndexOf</span><span class="p">(</span><span class="sc">'='</span><span class="p">);</span>
					<span class="k">if</span><span class="p">(</span><span class="n">equalsIdx</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                    <span class="p">{</span>
						<span class="n">String</span><span class="p">[]</span> <span class="n">keyValue</span> <span class="p">=</span> <span class="n">queryString</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="sc">'='</span><span class="p">);</span>
						<span class="n">res</span> <span class="p">+=</span> <span class="s">"\t\""</span> <span class="p">+</span> <span class="n">keyValue</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">+</span> <span class="s">"\": \""</span> <span class="p">+</span> <span class="n">keyValue</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="nf">Replace</span><span class="p">(</span><span class="s">"\""</span><span class="p">,</span> <span class="s">"%22"</span><span class="p">)</span> <span class="p">+</span> <span class="s">"\",\r\n"</span><span class="p">;</span>
					<span class="p">}</span>
                <span class="p">}</span>
			<span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
				<span class="kt">int</span> <span class="n">equalsIdx</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">IndexOf</span><span class="p">(</span><span class="sc">'='</span><span class="p">);</span>
				<span class="k">if</span><span class="p">(</span><span class="n">equalsIdx</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
					<span class="n">String</span><span class="p">[]</span> <span class="n">keyValue</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="sc">'='</span><span class="p">);</span>
					<span class="n">res</span> <span class="p">+=</span> <span class="s">"\t\""</span> <span class="p">+</span> <span class="n">keyValue</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">+</span> <span class="s">"\": \""</span> <span class="p">+</span> <span class="n">keyValue</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="nf">Replace</span><span class="p">(</span><span class="s">"\""</span><span class="p">,</span> <span class="s">"%22"</span><span class="p">)</span> <span class="p">+</span> <span class="s">"\",\r\n"</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
					<span class="k">return</span> <span class="s">""</span><span class="p">;</span>
				<span class="p">}</span>
            <span class="p">}</span>

			<span class="n">res</span> <span class="p">+=</span> <span class="s">"}\r\n\r\n"</span><span class="p">;</span>

			<span class="k">return</span> <span class="n">res</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="c1">// 인자로 받아온 세션 데이터에서</span>
		<span class="c1">// 필요한 요소 추출하여 Python 코드로 변환</span>
		<span class="k">private</span> <span class="k">void</span> <span class="nf">SessionToCode</span><span class="p">(</span><span class="n">Session</span> <span class="n">session</span><span class="p">)</span>
        <span class="p">{</span>
			<span class="n">String</span> <span class="n">result</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
			<span class="kt">var</span> <span class="n">req</span> <span class="p">=</span> <span class="n">session</span><span class="p">.</span><span class="n">oRequest</span><span class="p">;</span>
			<span class="kt">var</span> <span class="n">origin_headers</span> <span class="p">=</span> <span class="n">req</span><span class="p">.</span><span class="n">headers</span><span class="p">;</span>
			<span class="kt">var</span> <span class="n">headers</span> <span class="p">=</span> <span class="n">origin_headers</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>

			<span class="n">String</span> <span class="n">url</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
			<span class="n">String</span> <span class="n">fullUrl</span> <span class="p">=</span> <span class="n">session</span><span class="p">.</span><span class="n">fullUrl</span><span class="p">;</span>
            <span class="n">String</span> <span class="n">RequestMethod</span> <span class="p">=</span> <span class="n">session</span><span class="p">.</span><span class="n">RequestMethod</span><span class="p">;</span>

            <span class="n">String</span> <span class="n">RequestBody</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="n">session</span><span class="p">.</span><span class="n">RequestBody</span><span class="p">);</span>
            
            <span class="n">result</span> <span class="p">=</span> <span class="s">"#coding: utf-8\r\n\r\n"</span><span class="p">;</span>
            <span class="n">result</span> <span class="p">+=</span> <span class="s">"import requests\r\n\r\n\r\n"</span><span class="p">;</span>
            <span class="n">result</span> <span class="p">+=</span> <span class="s">"requests.packages.urllib3.disable_warnings()\r\n\r\n"</span><span class="p">;</span>

            <span class="n">result</span> <span class="p">+=</span> <span class="s">"s = requests.Session()\r\n\r\n"</span><span class="p">;</span>

			<span class="kt">int</span> <span class="n">questIdx</span> <span class="p">=</span> <span class="n">fullUrl</span><span class="p">.</span><span class="nf">IndexOf</span><span class="p">(</span><span class="sc">'?'</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">questIdx</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">result</span> <span class="p">+=</span> <span class="s">"url = \""</span> <span class="p">+</span>  <span class="p">(</span><span class="n">fullUrl</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="sc">'?'</span><span class="p">))[</span><span class="m">0</span><span class="p">]</span> <span class="p">+</span> <span class="s">"\"\r\n\r\n"</span><span class="p">;</span>
			<span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
				<span class="n">result</span> <span class="p">+=</span> <span class="s">"url = \""</span> <span class="p">+</span> <span class="n">fullUrl</span> <span class="p">+</span> <span class="s">"\"\r\n\r\n"</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="n">result</span> <span class="p">+=</span> <span class="s">"headers = {\r\n"</span><span class="p">;</span>
			<span class="k">foreach</span> <span class="p">(</span><span class="n">HTTPHeaderItem</span> <span class="n">header</span> <span class="k">in</span> <span class="n">headers</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">String</span> <span class="n">Name</span> <span class="p">=</span> <span class="n">header</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>
				<span class="n">String</span> <span class="n">Value</span> <span class="p">=</span> <span class="n">header</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
				<span class="n">result</span> <span class="p">+=</span> <span class="s">"\t\""</span> <span class="p">+</span> <span class="n">Name</span> <span class="p">+</span> <span class="s">"\": \""</span> <span class="p">+</span> <span class="n">Value</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s">"\""</span><span class="p">,</span> <span class="s">"%22"</span><span class="p">)</span> <span class="p">+</span> <span class="s">"\",\r\n"</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">result</span> <span class="p">+=</span> <span class="s">"}\r\n\r\n"</span><span class="p">;</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">RequestMethod</span> <span class="p">==</span> <span class="s">"GET"</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">questIdx</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">String</span> <span class="n">parsedQuery</span> <span class="p">=</span> <span class="n">fullUrl</span><span class="p">.</span><span class="nf">Substring</span><span class="p">(</span><span class="n">questIdx</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
					<span class="n">result</span> <span class="p">+=</span> <span class="nf">parseData</span><span class="p">(</span><span class="n">RequestMethod</span><span class="p">,</span> <span class="n">parsedQuery</span><span class="p">);</span>

					<span class="n">result</span> <span class="p">+=</span> <span class="s">"req = requests.get(url, headers=headers, params=data, verify=False)\r\n"</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">else</span>
				<span class="p">{</span>
					<span class="n">result</span> <span class="p">+=</span> <span class="s">"req = requests.get(url, headers=headers, verify=False)\r\n"</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>

			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">RequestMethod</span> <span class="p">==</span> <span class="s">"POST"</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">String</span> <span class="n">oRequestBody</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="n">session</span><span class="p">.</span><span class="n">RequestBody</span><span class="p">);</span>
				<span class="n">result</span> <span class="p">+=</span> <span class="nf">parseData</span><span class="p">(</span><span class="n">RequestMethod</span><span class="p">,</span> <span class="n">oRequestBody</span><span class="p">);</span>

				<span class="n">result</span> <span class="p">+=</span> <span class="s">"req = requests.post(url, headers=headers, data=data, verify=False)\r\n\r\n"</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="n">result</span> <span class="p">+=</span> <span class="s">"res = req.text\r\n\r\n"</span><span class="p">;</span>
			<span class="n">result</span> <span class="p">+=</span> <span class="s">"print(res)\r\n"</span><span class="p">;</span>
			
			<span class="n">textbox</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="n">result</span><span class="p">;</span>
			
        <span class="p">}</span>

		<span class="c1">// 드래그 중 텍스트박스에 진입했을 때</span>
		<span class="c1">// 마우스 커서 모양 변경</span>
		<span class="k">private</span> <span class="k">void</span> <span class="nf">DragEnter</span><span class="p">(</span><span class="kt">object</span> <span class="n">s</span><span class="p">,</span> <span class="n">DragEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
			<span class="n">e</span><span class="p">.</span><span class="n">Effect</span> <span class="p">=</span> <span class="n">DragDropEffects</span><span class="p">.</span><span class="n">Copy</span><span class="p">;</span>
        <span class="p">}</span>
		
		<span class="c1">// 드래그 후 텍스트박스에 놓았을 때</span>
		<span class="c1">// SessionToCode 함수 호출</span>
		<span class="k">private</span> <span class="k">void</span> <span class="nf">DragDrop</span><span class="p">(</span><span class="kt">object</span> <span class="n">s</span><span class="p">,</span> <span class="n">DragEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
			<span class="n">DataObject</span> <span class="n">obj</span> <span class="p">=</span> <span class="p">(</span><span class="n">DataObject</span><span class="p">)</span><span class="n">e</span><span class="p">.</span><span class="n">Data</span><span class="p">;</span>

			<span class="n">Session</span><span class="p">[]</span> <span class="n">sessions</span> <span class="p">=</span> <span class="p">(</span><span class="n">Session</span><span class="p">[])</span><span class="n">obj</span><span class="p">.</span><span class="nf">GetData</span><span class="p">(</span><span class="s">"Fiddler.Session[]"</span><span class="p">);</span>
			<span class="n">Session</span> <span class="n">session</span> <span class="p">=</span> <span class="n">sessions</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>

			<span class="nf">SessionToCode</span><span class="p">(</span><span class="n">session</span><span class="p">);</span>

			<span class="c1">// 값 자동 복사</span>
			<span class="n">textbox</span><span class="p">.</span><span class="nf">SelectAll</span><span class="p">();</span>
			<span class="n">textbox</span><span class="p">.</span><span class="nf">Copy</span><span class="p">();</span>
			<span class="n">textbox</span><span class="p">.</span><span class="nf">DeselectAll</span><span class="p">();</span>
		<span class="p">}</span>

		<span class="c1">// 세션 선택 후 'a' 키 눌렀을 때</span>
		<span class="c1">// SessionToCode 함수 호출</span>
		<span class="k">public</span> <span class="k">void</span> <span class="nf">KeyPress</span><span class="p">(</span><span class="kt">object</span> <span class="n">s</span><span class="p">,</span> <span class="n">KeyPressEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">KeyChar</span> <span class="p">==</span> <span class="m">97</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Session</span><span class="p">[]</span> <span class="n">SelectedSessions</span> <span class="p">=</span> <span class="n">FiddlerApplication</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="nf">GetSelectedSessions</span><span class="p">();</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">SelectedSessions</span><span class="p">.</span><span class="n">Length</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
					<span class="n">Session</span> <span class="n">session</span> <span class="p">=</span> <span class="n">SelectedSessions</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
                    <span class="nf">SessionToCode</span><span class="p">(</span><span class="n">session</span><span class="p">);</span>

					<span class="c1">//값 자동 복사</span>
					<span class="n">textbox</span><span class="p">.</span><span class="nf">SelectAll</span><span class="p">();</span>
					<span class="n">textbox</span><span class="p">.</span><span class="nf">Copy</span><span class="p">();</span>
					<span class="n">textbox</span><span class="p">.</span><span class="nf">DeselectAll</span><span class="p">();</span>

					<span class="c1">// 단축키 눌렀을 때 탭 페이지 이동</span>
					<span class="n">FiddlerApplication</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">tabsViews</span><span class="p">.</span><span class="nf">SelectTab</span><span class="p">(</span><span class="n">FiddlerApplication</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">tabsViews</span><span class="p">.</span><span class="n">TabPages</span><span class="p">.</span><span class="nf">IndexOf</span><span class="p">(</span><span class="n">page</span><span class="p">));</span>
				<span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

		<span class="k">public</span> <span class="k">void</span> <span class="nf">OnLoad</span><span class="p">()</span>
		<span class="p">{</span>
			<span class="n">page</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TabPage</span><span class="p">(</span><span class="s">"requests"</span><span class="p">);</span>
			<span class="n">page</span><span class="p">.</span><span class="n">ImageIndex</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Fiddler</span><span class="p">.</span><span class="n">SessionIcons</span><span class="p">.</span><span class="n">HTML</span><span class="p">;</span>

			<span class="n">textbox</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TextBox</span><span class="p">();</span>
			<span class="n">textbox</span><span class="p">.</span><span class="n">Multiline</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
			<span class="n">textbox</span><span class="p">.</span><span class="n">AcceptsTab</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
			<span class="n">textbox</span><span class="p">.</span><span class="n">AutoSize</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
			<span class="n">textbox</span><span class="p">.</span><span class="n">AllowDrop</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
			<span class="n">textbox</span><span class="p">.</span><span class="n">ReadOnly</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
			<span class="n">textbox</span><span class="p">.</span><span class="n">ScrollBars</span> <span class="p">=</span> <span class="n">ScrollBars</span><span class="p">.</span><span class="n">Both</span><span class="p">;</span>
			<span class="n">textbox</span><span class="p">.</span><span class="n">Dock</span> <span class="p">=</span> <span class="n">DockStyle</span><span class="p">.</span><span class="n">Fill</span><span class="p">;</span>

            <span class="c1">// 드래그 중 탭화면 진입 이벤트</span>
            <span class="n">textbox</span><span class="p">.</span><span class="n">DragEnter</span> <span class="p">+=</span> <span class="k">new</span> <span class="nf">DragEventHandler</span><span class="p">(</span><span class="n">DragEnter</span><span class="p">);</span>

			<span class="c1">// 드래그 중 탭화면에 끌어놓았을 때 이벤트</span>
			<span class="n">textbox</span><span class="p">.</span><span class="n">DragDrop</span> <span class="p">+=</span> <span class="k">new</span> <span class="nf">DragEventHandler</span><span class="p">(</span><span class="n">DragDrop</span><span class="p">);</span> 

			<span class="n">page</span><span class="p">.</span><span class="n">Controls</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">textbox</span><span class="p">);</span>

			<span class="c1">// Fiddler 탭에 페이지 추가</span>
            <span class="n">FiddlerApplication</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">tabsViews</span><span class="p">.</span><span class="n">TabPages</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>

			<span class="c1">// KeyPress 이벤트</span>
			<span class="n">FiddlerApplication</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">lvSessions</span><span class="p">.</span><span class="n">KeyPress</span> <span class="p">+=</span> <span class="k">new</span> <span class="nf">KeyPressEventHandler</span><span class="p">(</span><span class="n">KeyPress</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="k">public</span> <span class="k">void</span> <span class="nf">OnBeforeUnload</span><span class="p">()</span>
        <span class="p">{</span>

        <span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">3. 구현</code> 에서 설명한 방식을 토대로 기능을 구현한 전체 소스코드입니다. 현재는 GET, POST Method에서 일반적인 파라미터만 처리가 가능한 수준이며, 추후 JSON 및 파일 업로드 처리 등의 기능을 추가할 예정입니다.</p>

<h1 id="5-기능">5. 기능</h1>

<p><img src="/assets/sun0707.png" alt="/assets/sun0707.png" /></p>

<ol>
  <li>Fiddler 좌측의 세션뷰에서 항목을 선택한 뒤 ‘a’를 누르면 자동으로 <code class="highlighter-rouge">requests</code> 탭으로 이동하며, Python Requests 모듈을 이용하여 HTTP Request를 요청할 수 있는 기반 코드를 생성해줍니다.</li>
  <li>또는 <code class="highlighter-rouge">requests</code> 탭을 활성화시킨 상태에서 세션 항목을 드래그하여 끌어다 놓아도 동일한 결과를 얻을 수 있습니다.</li>
</ol>

<p>변환 시 내용은 클립보드에 자동으로 복사됩니다.</p>

<h1 id="5-참조">5. 참조</h1>

<p><a href="https://docs.telerik.com/fiddler/Extend-Fiddler/ExtendWithDotNet">https://docs.telerik.com/fiddler/Extend-Fiddler/ExtendWithDotNet</a></p>

<p><a href="https://gist.github.com/y3rsh/1054336/6df9d5f12079966fa845d243fbe1a7581be1358b">https://gist.github.com/y3rsh/1054336/6df9d5f12079966fa845d243fbe1a7581be1358b</a></p>

<p><a href="https://github.com/qiaofei32/Fiddler-Request-To-code">https://github.com/qiaofei32/Fiddler-Request-To-code</a></p>

<p><a href="https://www.cnblogs.com/milantgh/p/4805280.html">https://www.cnblogs.com/milantgh/p/4805280.html</a></p>

   </div>
</div>


  <!-- Start disqus 
<script src="/assets/js/disqusLoader.js" /></script>
<div id="disqus_thread"><h3>Discussion and feedback</h3></div>
<div class="disqus"></div>
<script>
    disqusLoader('.disqus', {
        scriptUrl: 'https://jekyll-tale.disqus.com/embed.js'
    });
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
End disqus -->


<div class="pagination">
  
   <a href="/2020-07-01/Intent-logging" class="left arrow">&#8592;</a>
  
  
   <a href="/2020-07-01/Android-Application-Dynamic-Analysis-in-Remote-Nox" class="right arrow">&#8594;</a>
  

  <a href="#" class="top">Top</a>
</div>
    </main>

    <!--footer>
  <span>
    &copy; <time datetime="2021-01-13 00:53:43 +0000">2021</time> Core-Research-Team. Made with Jekyll using the <a href="https://github.com/chesterhow/tale/">Tale</a> theme.
  </span>
</footer-->

  </body>
</html>
